<aside class="accounts" role="menu" ng-class="{'edit-mode': layout.isEditAccountsMode}" ng-if="!expCalc.meta.isViewMode">
	<ul class="aside-head flex">
		<li class="s-p2">
			<label class="toggle">
				<input type="checkbox" ng-model="layout.isEditAccountsMode">
				<i></i>
			</label>
		</li>

		<li class="flex-grow">
			<div class="text-field bold">
				<b>Режим редактирования</b>
			</div>
		</li>
	</ul>

	<div class="text-field solid title thin uppercase text-center">
		<b>Выбор и настройка расчета:</b>
	</div>

	<ul class="aside-head flex" ng-if="expCalc.accounts.length">
		<li class="s-p2">
			<label class="toggle">
				<input type="checkbox"
					   ng-model="expCalc.accounts[expCalc.settings.currentAccount].settings.advancedMode"
					   ng-change="uploadData()">
				<i></i>
			</label>
		</li>

		<li class="flex-grow">
			<div class="text-field">
				<b>Расширенный режим расчета<br/>(типы расходов и мультивалюта)</b>
			</div>
		</li>
	</ul>

	<ul class="aside-head flex s-p1" ng-if="expCalc.accounts.length">
		<li class="s-p1">
			<label class="text-select currency">
				<select ng-model="expCalc.accounts[expCalc.settings.currentAccount].settings.accountCurrency"
						ng-options="key as value for (key, value) in expCalc.settings.currencies.names" ng-change="uploadData()">
				</select>
				<b>{{expCalc.settings.currencies.names[expCalc.accounts[expCalc.settings.currentAccount].settings.accountCurrency].substring(0, 3)}}</b>
			</label>
		</li>

		<li class="flex-grow s-p1">
			<div class="text-field">
				<b>Основная валюта в текущем расчете</b>
			</div>
		</li>
	</ul>

	<div class="aside-body">
		<ul>
			<li class="account flex"
				ng-class="{'active': expCalc.settings.currentAccount == $index}"
				ng-repeat="account in expCalc.accounts track by $index">
				<div>
					<button class="btn solid edit-mode no-shadow" ng-click="removeCurrentAccount($index)">
						<i class="fas fa-trash-alt"></i>
					</button>
				</div>

				<div class="flex-grow">
					<button class="btn solid border view-mode" ng-click="openCurrentAccount($index)">
						<b>{{(account.meta.title) ? account.meta.title : 'Расчёт ' + ($index + 1)}}</b>
					</button>

					<label class="text-input edit-mode">
						<input type="text" placeholder="Название расчета"
							   ng-model="account.meta.title"
							   ng-change="validateJSON(account.meta, 'title') && uploadData()">
						<b data-placeholder="Название расчета">{{account.meta.title}}</b>
					</label>
				</div>
			</li>

			<li class="account edit-mode flex">
				<div>
					<button class="btn no-shadow" ng-click="createAccount()">
						<i class="fas fa-plus"></i>
					</button>
				</div>

				<div class="flex-grow s-p1">
					<div class="text-field solid">
						<b>Создать новый расчет</b>
					</div>
				</div>
			</li>
		</ul>

	</div>
</aside>

<main ng-click="layout.closeMenu(); layout.isOpenAside = false;" role="main">

	<article class="about-service">
		<h1 ng-if="expCalc.meta.isViewMode && !expCalc.accounts.length">
			Эта ссылка устарела. Данных по этой ссылке не существует!
		</h1>

		<p>
		Cost Panel - калькулятор учета и распределения расходов между участниками.
		Калькулятор поможет быстро рассчитать доли каждого участника общего расхода и подскажет как рассчитаться между собой.
		Вносите траты в любой валюте, указывайте для кого их рассчитать и калькулятор распределения расходов покажет -
		кто кому и в какой валюте должен вернуть с учетом ранее внесенных средств. Также в этом калькуляторе можно создавать
		список будущих покупок онлайн одним человеком и в это же время в магазине открыть его на любом девайсе другим
		человеком, чтобы строго следовать этому перечню. А статистика распределения расходов отобразит полезную информацию:
		тип расхода, дата, доля, взнос, остаток.
		</p>
	</article>


	<div class="three-window-lt" data-active-window="{{layout.activeWindow}}" ng-if="expCalc.accounts.length">
		<div class="header-lt">
			<ul class="flex" role="tablist">
				<li>
					<button class="btn no-shadow" ng-mobile-click="layout.activeWindow = 1">
						<b>1.</b>
						<i class="fas fa-list only-middle-mobile"></i>
						<b class="small no-middle-mobile">Список</b>
					</button>
				</li>

				<li>
					<button class="btn no-shadow" ng-mobile-click="layout.activeWindow = 2">
						<b>2.</b>
						<i class="fas fa-calculator only-middle-mobile"></i>
						<b class="small no-middle-mobile">Вычисление</b>
					</button>
				</li>

				<li>
					<button class="btn no-shadow" ng-mobile-click="layout.activeWindow = 3">
						<b>3.</b>
						<i class="fas fa-exchange-alt only-middle-mobile"></i>
						<b class="small no-middle-mobile">Возврат</b>
					</button>
				</li>
			</ul>
		</div>

		<ul class="windows-lt" role="tabpanel"
			ng-repeat="account in expCalc.accounts track by $index"
			ng-if="expCalc.settings.currentAccount == $index">

			<li id="window-1" class="left-lt step-1" ng-class="(layout.activeWindow == 1) ? 'active' : ''" ng-click="layout.activeWindow = 1">
				<div class="title-lt flex">
					<div class="flex-grow s-p3">1. Список</div>
					<div class="s-p3">1</div>
				</div>

				<div class="window-lt">

					<div class="section-head">
						<div class="help-text no-arrow"
							 ng-if="expCalc.settings.isHelpMode">
							<b><i class="fas fa-info-circle"></i> Включен режим отображения подсказок!
								Выключить можно в МЕНЮ <i class="fas fa-arrow-right"></i> РЕЖИМЫ</b>
						</div>

						<ul class="flex">
							<li class="flex-shrink">
								<div class="text-field title">
									<b>Шаг 1:</b>
								</div>
							</li>

							<li class="flex-grow s-p2">
								<div class="text-field name word-wrap border-bottom">
									<b>Список участников и расходов</b>
								</div>
							</li>

							<li class="flex-shrink">
								<button class="btn solid" title="Спрятать всё"
										ng-mobile-click="layoutControl.collapseAllBodiesView(1, 'window-1')">
									<i class="fas fa-angle-double-up"></i>
								</button>
							</li>
						</ul>

						<div class="s-p1">
							<label class="toggle">
								<input type="checkbox" ng-model="layout.isRemoveMode">
								<i></i>
							</label>

							<div class="text-field s-p2">
								<b>Режим удаления данных</b>
							</div>
						</div>

                        <div class="text-right" ng-if="expCalc.settings.isHelpMode">
                            <div class="help-text bottom right">
                                <b>
                                    <i class="fas fa-info-circle"></i> Это основная валюта текущего расчета. Её можно менять
                                    для определенного расчета в РАСЧЕТЫ (вверху справа экрана). А также выбрать для всех
                                    расчетов как базовую в МЕНЮ <i class="fas fa-arrow-right"></i> ДАННЫЕ
                                    <i class="fas fa-arrow-right"></i> ВАЛЮТА. Там же возможно добавить любую новую валюту.
                                </b>
                            </div>
                        </div>

						<ul class="flex">
							<li class="flex-shrink">
								<div class="text-field title">
									<b>Всего расходов:</b>
								</div>
							</li>

							<li class="flex-grow s-p1">
								<div class="number-field dashed bold" title="Сумма абсолютно всех расходов всех участников">
									<b>{{roundOff(getAccountTotal())}}</b>
								</div>
							</li>

							<li class="s-p1">
								<div class="text-field title currency">
									<b>{{getAccountCurrency()}}</b>
								</div>
							</li>
						</ul>
					</div>

					<div class="section-body">

						<ul class="participants">
							<li id="participant.1.{{participantIndex}}" class="participant"
								ng-repeat="participant in account.participants track by $index"
								ng-init="participantIndex = $index">

								<div class="participant-head">
									<ul class="flex s-p0">
										<li class="flex-shrink s-p0">
											<div class="text-field solid title remove-mode-false">
												<b>{{participantIndex + 1}}.</b>
											</div>

											<button class="btn solid border warning remove-mode-true"
													ng-click="removeParticipant(participantIndex)">
												<i class="fas fa-trash-alt"></i>
												<b>{{participantIndex + 1}}.</b>
											</button>
										</li>

										<li class="flex-grow s-p0">
											<label class="text-input big-font">
												<input type="text" placeholder="Имя участника {{participantIndex + 1}}"
													   ng-model="participant.meta.title"
													   ng-change="validateJSON(participant.meta, 'title') && uploadData()">
												<b data-placeholder="Имя участника {{participantIndex + 1}}">{{participant.meta.title}}</b>
											</label>
										</li>

										<li class="flex-shrink s-p0">
											<div class="number-field solid" title="Сумма всех расходов этого участника">
												<b>
													{{roundOff(getParticipantTotal(participant))}}
													<s>{{getAccountCurrency()}}</s>
												</b>
											</div>
										</li>

										<li class="flex-shrink s-p0">
											<button class="btn solid border collapse-btn" title="Показать/Спрятать"
													ng-mobile-click="layoutControl.toggleBodyView(1, 'participant.1.' + participantIndex)">
												<i class="fas fa-chevron-down"></i>
											</button>
										</li>
									</ul>
								</div>

								<div class="participant-body">

									<ul class="body-view expenses s-p0">
										<li class="flex meta-bar" ng-if="participant.expenses.length > 5">
											<div class="text-field name word-wrap s-p0">
												<b>Количество расходов: {{participant.expenses.length}}</b>
											</div>

											<div class="flex-grow text-field text-right s-p0">
												<b>Прокрутка к последнему расходу участника</b>
											</div>

											<div class="s-p0">
												<button class="btn solid"
														title="Прокрутка к последнему расходу участника"
														ng-mobile-click="layoutControl.scrollToLastExpense(1, 'participant.1.' + participantIndex)">
													<i class="fas fa-arrow-circle-down"></i>
												</button>
											</div>
										</li>

										<li class="help-bar text-right s-p0" ng-if="expCalc.settings.isHelpMode && participant.expenses.length > 0">
											<div class="help-text attention bottom right" ng-if="!participant.expenses[0].isPaid">
												<b><i class="fas fa-info-circle"></i> После заполнения расхода, не забудьте применить его</b>
											</div>
										</li>

										<li class="expense"
											ng-repeat="expense in participant.expenses track by $index"
											ng-init="expenseIndex = $index">

											<ul class="flex expense-title">
												<li class="flex-shrink expense-number s-p0" ng-class="{'local-remove-mode': !expense.title.length}">
													<div class="text-field title remove-mode-false">
														<b>{{participantIndex + 1}}.{{expenseIndex + 1}}</b>
													</div>

													<button class="btn solid warning remove-mode-true" title="Удалить этот расход"
															ng-click="removeExpense(participantIndex, expenseIndex)">
														<i class="fas fa-trash-alt"></i>
														<b>{{participantIndex + 1}}.{{expenseIndex + 1}}</b>
													</button>
												</li>

												<li class="flex-hidden flex-grow s-p0">
													<div class="multiple-field">
														<label class="text-input" ng-disabled="expense.isPaid">
															<input type="text" placeholder="Название расхода"
																   ng-model="expense.title"
																   ng-change="validateJSON(expense, 'title') && uploadData()">
															<b data-placeholder="Название расхода" ng-if="!expense.title.length"></b>
															<b ng-if="expense.title.length">
																<i class="fas fa-{{expCalc.settings.expensesTypes[expense.type].icon}} only-mobile"></i>
																{{expense.title}}
															</b>
														</label>

														<label class="text-select icons no-mobile"
															   ng-disabled="expense.isPaid"
															   ng-if="expCalc.accounts[expCalc.settings.currentAccount].settings.advancedMode">
															<select ng-model="expense.type" ng-change="uploadData()">
																<option ng-repeat="expensesType in expCalc.settings.expensesTypes track by $index"
																		value="{{$index}}" ng-selected="expense.type == $index">
																	{{expensesType.name}}
																</option>
															</select>
															{{expCalc.settings.expensesTypes[expense.type]}}
															<b>
																<i class="fas fa-{{expCalc.settings.expensesTypes[expense.type].icon}}"></i>
															</b>
														</label>
													</div>
												</li>

												<li class="flex-hidden flex-grow flex-shrink s-p0">
													<div class="multiple-field">
														<label class="text-select currency no-mobile"
															   ng-class="{'hidden': !expCalc.accounts[expCalc.settings.currentAccount].settings.advancedMode}"
															   ng-disabled="expense.isPaid">
															<select ng-model="expense.currency"
																	ng-change="uploadData()"
																	ng-options="key as value for (key, value) in expCalc.settings.currencies.names">
															</select>
															<b>{{expCalc.settings.currencies.names[expense.currency].substring(0, 3)}}</b>
														</label>

														<label class="number-input" ng-disabled="expense.isPaid">
															<input type="number" placeholder="Стоимость"
																   ng-model="expense.value"
																   ng-change="uploadData()">
															<b data-placeholder="Стоимость" ng-if="expense.value === null"></b>
															<b ng-if="expense.value !== null">
																{{expense.value}}
																<s class="only-mobile">{{expCalc.settings.currencies.names[expense.currency].substring(0, 3)}}</s>
															</b>
														</label>
													</div>
												</li>
											</ul>

											<div id="details{{participantIndex}}.{{expenseIndex}}"
												 class="expense-data clearfix"
												 ng-class="{'completed': completedDetails(expense)}">

												<ul class="flex expense-values only-mobile"
													ng-class="{'hidden': expense.isPaid}"
													ng-if="expCalc.accounts[expCalc.settings.currentAccount].settings.advancedMode">
													<li class="s-p0">
														<label class="text-select icons">
															<select ng-model="expense.type" ng-change="uploadData()">
																<option ng-repeat="expensesType in expCalc.settings.expensesTypes track by $index"
																		value="{{$index}}" ng-selected="expense.type == $index">
																	{{expensesType.name}}
																</option>
															</select>
															{{expCalc.settings.expensesTypes[expense.type]}}
															<b>
																<i class="fas fa-{{expCalc.settings.expensesTypes[expense.type].icon}}"></i>
															</b>
														</label>
													</li>

													<li class="flex-grow flex-hidden s-p0 text-center">
														<div class="text-field">
															<b>{{formatDate(expense.date)}}</b>
														</div>
													</li>

													<li class="s-p0">
														<label class="text-select currency">
															<select ng-model="expense.currency"
																	ng-change="uploadData()"
																	ng-options="key as value for (key, value) in expCalc.settings.currencies.names">
															</select>
															<b>{{expCalc.settings.currencies.names[expense.currency].substring(0, 3)}}</b>
														</label>
													</li>
												</ul>

												<div class="help-text no-arrow"
													 ng-if="expCalc.settings.isHelpMode && expCalc.accounts[expCalc.settings.currentAccount].settings.advancedMode && !expenseIndex">
													<b><i class="fas fa-info-circle"></i> Тип расхода и валюту можно добавлять, редактировать,
														получать актуальные курсы в МЕНЮ <i class="fas fa-arrow-right"></i> ДАННЫЕ</b>
												</div>

												<div class="expense-details">

													<div class="details-view">

														<ul class="flex flex-wrap s-p2">
															<li class="s-p0">
																<div class="text-field name thin">
																	<b>Дата и время:</b>
																</div>
															</li>

															<li class="s-p0">
																<div class="text-field thin">
																	<b>{{formatDate(expense.date)}}</b>
																</div>
															</li>
														</ul>

                                                        <div class="p-2" ng-if="expCalc.settings.isHelpMode">
                                                            <div class="help-text bottom">
                                                                <b><i class="fas fa-info-circle"></i> {{getParticipationTooltip(expense.partList)}}<br/>Редактировать это распределение можно после отмены этого расхода (снять галочку) или во втором окне (шаг 2: вычисление).</b>
                                                            </div>
                                                        </div>

														<ul class="members flex flex-wrap justify-content-start">
															<li class="py-1 pr-3">
																<div class="text-field name thin">
																	<b>Участники:</b>
																</div>
															</li>

															<li class="py-1" ng-repeat="participation in expense.partList track by $index">
																<label class="checkbox decoration thin">
																	<input type="checkbox"
																		   ng-model="expense.partList[$index]"
																		   ng-disabled="expense.isPaid"
																		   ng-change="checkPartList(expense.partList, $index)">
																	<i></i>
																	<b>{{getParticipantName(account.participants[$index].meta.title, $index)}}</b>
																</label>
															</li>
														</ul>

														<div class="details">

                                                            <div class="flex flex-wrap to-right-content">
                                                                <div class="flex-grow text-field name thin s-p2">
                                                                    <b class="s-p0">Подробности:</b>
                                                                </div>
                                                                <div class="text-field thin small" ng-if="expense.details.length" title="Суммарная цена пунктов - отмеченных/всех">
                                                                    <b class="s-p0">Суммарная цена:</b>
                                                                </div>
                                                                <div class="text-field name thin currency" ng-if="expense.details.length" title="Суммарная цена пунктов - отмеченных/всех">
                                                                    <b class="s-p0">
                                                                        {{getExpenseDetailsTotal(expense.details, true)}} / {{getExpenseDetailsTotal(expense.details, false)}}
                                                                    </b>
                                                                </div>
                                                            </div>

															<div class="help-text bottom" ng-if="expCalc.settings.isHelpMode && !expense.details.length">
																<b>
																	<i class="fas fa-info-circle"></i> Здесь можно создать подробный список пунктов, из которых состоит текущий расход.

																	<div ng-if="!$index">
																		Список можно создать заранее, чтобы потом в магазине строго ему следовать.<br/>
																		Работать с данными возможно с разных устройств, если войти под одним и тем же аккаунтом:<br/>
																		на одном устройстве данные вносятся, а на другом - просматриваются/редактируются.
																	</div>
																</b>
															</div>

															<ul class="flex details-item"
																ng-class="{'checked': detail.isChecked}"
																ng-repeat="detail in expense.details track by $index"
																ng-init="detailIndex = $index">

																<li class="s-p0" ng-class="{'local-remove-mode': !detail.title.length}">
																	<label class="checkbox remove-mode-false">
																		<input type="checkbox" ng-model="detail.isChecked" ng-change="uploadData()">
																		<i></i>
																		<b>{{detailIndex + 1}}.</b>
																	</label>

																	<button class="btn solid warning remove-mode-true" title="Удалить этот пункт"
																			ng-click="removeDetailsFromExpense(expense, detailIndex)">
																		<i class="fas fa-trash-alt"></i>
																		<b>{{detailIndex + 1}}.</b>
																	</button>
																</li>

																<li class="flex-grow flex-hidden s-p0">
																	<div class="multiple-field">
																		<label class="text-input not-fixed-height" ng-disabled="detail.isChecked">
																			<!--<input type="text" placeholder="Название"-->
																				   <!--ng-model="detail.title" ng-change="validateJSON(detail, 'title') && uploadData()">-->
																			<textarea placeholder="Название"
																					  ng-model="detail.title" ng-change="validateJSON(detail, 'title') && uploadData()"></textarea>
																			<b data-placeholder="Название">{{detail.title}}</b>
																		</label>

																		<label class="text-input text-center min-field"
																			   ng-disabled="detail.isChecked">
																			<input type="text" placeholder="Кол."
																				   ng-model="detail.qty" ng-change="validateJSON(detail, 'qty') && uploadData()">
																			<b data-placeholder="Кол.">{{detail.qty}}</b>
																		</label>
																	</div>
																</li>

																<li class="cost s-p0">
																	<label class="number-input" ng-disabled="detail.isChecked">
																		<input type="number" placeholder="Цена"
																			   ng-model="detail.value" ng-change="uploadData()">
																		<b data-placeholder="Цена">{{detail.value}}</b>
																	</label>
																</li>
															</ul>

														</div>

													</div>

													<ul class="flex details-item details-control">
														<li class="details-buttons flex-grow s-p0">
															<button class="btn solid success new-point-btn" ng-click="addNewDetailsToExpense(expense)">
																<i class="fas fa-plus"></i>
																<b class="small">Пункт</b>
															</button>
														</li>

														<li class="details-title">
															<div class="text-field name">
																<b>Детали этого расхода</b>
															</div>
														</li>

														<li class="s-p0">
															<button class="btn solid details-btn"
																	ng-click="layoutControl.toggleDetailsView1('details' + participantIndex + '.' + expenseIndex)">
																<i class="fas fa-folder"></i>
																<b class="small no-middle-mobile">Детали</b>
															</button>
														</li>
													</ul>

												</div>

											</div>

											<label class="checkbox paid-out">
												<input type="checkbox" ng-model="expense.isPaid"
													   ng-change="uploadData()"
													   ng-click="expense.isPaid ? layoutControl.toggleDetailsView1('details' + participantIndex + '.' + expenseIndex, -1) : false">
												<i></i>
											</label>

										</li>

										<li class="expense">
											<ul class="flex expense-title">
												<li class="flex-shrink expense-number s-p0">
													<button class="btn solid success" title="Новый расход"
															ng-click="addNewExpense(participant, participantIndex)">
														<i class="fas fa-plus"></i>
													</button>
												</li>

												<li class="s-p2">
													<div class="text-field name word-wrap">
														<b>Новый расход участнику
															<span>{{(participant.meta.title) ? participant.meta.title : participantIndex + 1}}</span>
														</b>
													</div>
												</li>
											</ul>
										</li>

									</ul>

								</div>
							</li>

							<li class="participant">
								<div class="participant-head">
									<ul class="flex s-p0">
										<li class="flex-shrink s-p0">
											<button class="btn solid border success" ng-click="createParticipant()">
												<i class="fas fa-plus"></i>
											</button>
										</li>

										<li class="flex-grow s-p2">
											<div class="text-field solid name">
												<b>Добавить нового участника</b>
											</div>
										</li>
									</ul>
								</div>
							</li>
						</ul>

					</div>

				</div>

				<div class="control-lt">
					<button class="btn solid border"
							title="Прокрутка вверх к началу"
							ng-click="layoutControl.scrollUp(1)">
						<i class="fas fa-arrow-circle-up"></i>
					</button>
				</div>
			</li>

			<li id="window-2" class="center-lt step-2" ng-class="(layout.activeWindow == 2) ? 'active' : ''" ng-click="layout.activeWindow = 2">
				<div class="title-lt flex">
					<div class="flex-grow s-p3">2. Вычисление</div>
					<div class="s-p3">2</div>
				</div>

				<div class="window-lt">

					<div class="section-head">
						<div class="help-text no-arrow"
							 ng-if="expCalc.settings.isHelpMode">
							<b><i class="fas fa-info-circle"></i> Включен режим отображения подсказок!
								Выключить можно в МЕНЮ <i class="fas fa-arrow-right"></i> РЕЖИМЫ</b>
						</div>

						<ul class="flex">
							<li class="flex-shrink">
								<div class="text-field title">
									<b>Шаг 2:</b>
								</div>
							</li>

							<li class="flex-grow s-p2">
								<div class="text-field name word-wrap border-bottom">
									<b>Расчет на каждого участника</b>
								</div>
							</li>

							<li class="flex-shrink">
								<button class="btn solid" title="Спрятать всё"
										ng-mobile-click="layoutControl.collapseAllBodiesView(2, 'window-2')">
									<i class="fas fa-angle-double-up"></i>
								</button>
							</li>
						</ul>

						<ul class="flex">
							<li class="flex-shrink">
								<div class="text-field title">
									<b>Всего вернуть:</b>
								</div>
							</li>

							<li class="flex-grow s-p1">
								<div class="number-field dashed bold">
									<b>{{roundOff(getFullRefund())}}</b>
								</div>
							</li>

							<li class="s-p1">
								<div class="text-field title currency">
									<b>{{getAccountCurrency()}}</b>
								</div>
							</li>
						</ul>
					</div>

					<div class="section-body">
						<ul class="participants">

							<li id="participant.2.{{extParticipantIndex}}" class="participant"
								ng-repeat="extParticipant in account.participants track by $index"
								ng-init="extParticipantIndex = $index">

								<div class="help-text bottom right"
                                     ng-class="{'attention': layout.activeWindow == 2}"
                                     ng-if="expCalc.settings.isHelpMode && !$index">
									<b><i class="fas fa-info-circle"></i> Если в качестве участника выступает не 1 человек, а группа из 2-х, 3-х и т.д. людей,
										поменяйте коэффициент участия — укажите соответствующее количество человек (2, 3 и т.д.), чтобы расчет прошел в правильных пропорциях</b>
								</div>

								<div class="participant-head">
									<ul class="flex s-p0">
										<li class="flex-shrink s-p0">
											<div class="text-field solid title">
												<b>{{extParticipantIndex + 1}}.</b>
											</div>
										</li>

										<li class="flex-grow s-p0">
											<div class="text-field title bold solid">
                                                <b>{{getParticipantName(extParticipant.meta.title, extParticipantIndex)}}</b>
											</div>
										</li>

										<li class="flex-shrink s-p0">
											<div class="number-input complex-input"
												 title="Если в качестве участника выступает не 1 человек, а группа из 2-х, 3-х и т.д. людей, укажите соответствующее количество человек (2, 3 и т.д.), чтобы расчет прошел в правильных пропорциях">
												<div class="text-field">
													<b>Коэфф.<br/>участия</b>
												</div>

												<label class="text-center">
													<input type="number" ng-model="extParticipant.meta.participation" ng-change="uploadData()" />
													<b>{{extParticipant.meta.participation}}</b>
												</label>
											</div>
										</li>

										<li class="flex-shrink s-p0">
											<button class="btn solid border collapse-btn" title="Показать/Спрятать"
													ng-mobile-click="layoutControl.toggleBodyView(2, 'participant.2.' + extParticipantIndex)">
												<i class="fas fa-chevron-down"></i>
											</button>
										</li>
									</ul>

									<ul class="flex report">
										<li class="flex-grow">
											<div class="number-field solid marker text-left" title="Отрицательный баланс означает долг участника, положительный - ему столько вернут">
												<b>
													{{roundOff(getBalance(extParticipant))}}
													<s>Баланс ({{getAccountCurrency()}}):</s>
												</b>
											</div>
										</li>

										<li class="flex-grow">
											<div class="number-field solid marker" title="Доля участника в общем расходе">
												<b>
													{{roundOff(getParticipantShare(extParticipantIndex))}}
													<s>Доля ({{getAccountCurrency()}}):</s>
												</b>
											</div>
										</li>
									</ul>
								</div>

								<div class="participant-body">

									<ul class="body-view shares">
                                        <li class="p-2" ng-if="expCalc.settings.isHelpMode">
                                            <div class="help-text bottom">
                                                <b><i class="fas fa-info-circle"></i> Здесь полный список всех расходов. Отмеченный расход означает, что он учитывается для данного участника. А указанные суммы означают долю участника от полной стоимости расхода.</b>
                                            </div>
                                        </li>

										<li class="share" ng-repeat="intParticipant in account.participants track by $index"
                                            ng-init="intParticipantIndex = $index"
                                            ng-if="intParticipant.expenses.length">
                                            <div class="text-right small" ng-if="!intParticipantIndex">
                                                Доли от каждого расхода:
                                            </div>

                                            <div ng-repeat="expense in intParticipant.expenses track by $index"
                                                 ng-init="intParticipantExpenseIndex = $index"
                                                 ng-if="expense.isPaid && expense.value > 0">

											    <ul class="flex s-p0"
                                                title="Доля участника [{{getParticipantName(extParticipant.meta.title, extParticipantIndex)}}] в расходах [{{getExpenseName(expense.title, intParticipantIndex, intParticipantExpenseIndex, true)}} от {{getParticipantName(intParticipant.meta.title, intParticipantIndex)}}]
составляет {{roundOff(getExpenseShare(expense, extParticipantIndex))}} {{getAccountCurrency()}} - это {{getPercentage(roundOff(getExpenseShare(expense, extParticipantIndex)), roundOff(intParticipant.expenses[intParticipantExpenseIndex].value))}}% от полной стоимости этого расхода - {{roundOff(intParticipant.expenses[intParticipantExpenseIndex].value)}} {{expCalc.settings.currencies.names[intParticipant.expenses[intParticipantExpenseIndex].currency].toUpperCase()}}">
                                                    <li class="s-p0">
                                                        <label class="checkbox line-through">
                                                            <input type="checkbox"
                                                                   ng-model="expense.partList[extParticipantIndex]"
                                                                   ng-change="checkPartList(expense.partList, extParticipantIndex)">
                                                            <i></i>
                                                        </label>
                                                    </li>

                                                    <li class="flex-grow flex-hidden s-p0">
                                                        <div class="text-field" ng-class="{'line-through': !expense.partList[extParticipantIndex]}">
                                                            <b>
                                                                {{getExpenseName(expense.title, intParticipantIndex, intParticipantExpenseIndex)}}
                                                                <em>[от: {{getParticipantName(intParticipant.meta.title, intParticipantIndex)}}]</em>
                                                            </b>
                                                        </div>
                                                    </li>

                                                    <li class="flex-shrink s-p0 share-price">
                                                        <div class="number-field" ng-class="{'hidden': !expense.partList[extParticipantIndex]}">
                                                            <b class="text-nowrap">
                                                                <s>доля</s>
                                                                {{roundOff(getExpenseShare(expense, extParticipantIndex))}}
                                                                <s>{{getAccountCurrency()}}</s>
                                                                <s class="block mt-1">
                                                                    от&nbsp;{{roundOff(intParticipant.expenses[intParticipantExpenseIndex].value)}}
                                                                    {{expCalc.settings.currencies.names[intParticipant.expenses[intParticipantExpenseIndex].currency].toUpperCase()}}
                                                                </s>
                                                            </b>
                                                        </div>
                                                    </li>
                                                </ul>

                                                <div class="help-text small right pl-3" ng-if="expCalc.settings.isHelpMode && roundOff(getExpenseShare(expense, extParticipantIndex))">
                                                    <b><i class="fas fa-info-circle"></i> Доля участника [{{getParticipantName(extParticipant.meta.title, extParticipantIndex)}}] в расходах [{{getExpenseName(expense.title, intParticipantIndex, intParticipantExpenseIndex, true)}} от {{getParticipantName(intParticipant.meta.title, intParticipantIndex)}}]
                                                        составляет {{roundOff(getExpenseShare(expense, extParticipantIndex))}} {{getAccountCurrency()}} - это {{getPercentage(getExpenseShare(expense, extParticipantIndex), intParticipant.expenses[intParticipantExpenseIndex].value)}}% от полной стоимости этого расхода - {{roundOff(intParticipant.expenses[intParticipantExpenseIndex].value)}} {{expCalc.settings.currencies.names[intParticipant.expenses[intParticipantExpenseIndex].currency].toUpperCase()}}</b>
                                                </div>
                                            </div>
										</li>

                                        <li class="share" ng-if="!getShareTotal()">
                                            <div class="text-field text-center block s-p2">
                                                <b><em>Нет никаких расходов</em></b>
                                            </div>
                                        </li>
									</ul>

								</div>
							</li>

						</ul>
					</div>

				</div>

				<div class="control-lt">
					<button class="btn solid border"
							title="Прокрутка вверх к началу"
							ng-click="layoutControl.scrollUp(2)">
						<i class="fas fa-arrow-circle-up"></i>
					</button>
				</div>
			</li>

			<li id="window-3" class="right-lt step-3" ng-class="(layout.activeWindow == 3) ? 'active' : ''" ng-click="layout.activeWindow = 3">
				<div class="title-lt flex">
					<div class="flex-grow s-p3">3. Возврат</div>
					<div class="s-p3">3</div>
				</div>

				<div class="window-lt">

					<div class="section-head">
						<div class="help-text no-arrow"
							 ng-if="expCalc.settings.isHelpMode">
							<b><i class="fas fa-info-circle"></i> Включен режим отображения подсказок!
								Выключить можно в МЕНЮ <i class="fas fa-arrow-right"></i> РЕЖИМЫ</b>
						</div>

						<ul class="flex">
							<li class="flex-shrink">
								<div class="text-field title">
									<b>Шаг 3:</b>
								</div>
							</li>

							<li class="flex-grow s-p2">
								<div class="text-field name word-wrap border-bottom">
									<b>Фиксация возвратов</b>
								</div>
							</li>

							<li class="flex-shrink">
								<button class="btn solid" title="Спрятать всё"
										ng-mobile-click="layoutControl.collapseAllBodiesView(3, 'window-3')">
									<i class="fas fa-angle-double-up"></i>
								</button>
							</li>
						</ul>

                        <div ng-if="expCalc.settings.isHelpMode" class="help-text bottom center m-0 mt-2">
                            <b><i class="fas fa-info-circle"></i> Выбирайте способ расчета между собой: "возвраты напрямую" или "через общий банк".</b>
                        </div>

						<div class="mode-toggle">
							<input type="checkbox" ng-model="account.settings.fixationDirectly">
							<i></i>
							<div>
								<b>Через общий банк</b>
							</div>
							<div>
								<b>Возвраты напрямую</b>
							</div>
						</div>

						<!-- Возвраты напрямую -->
						<div ng-if="account.settings.fixationDirectly">
							<ul class="flex flex-wrap">
								<li class="flex-shrink">
									<div class="text-field title thin">
										<b>Баланс возвратов:</b>
									</div>
								</li>

								<li class="flex-grow s-p1">
									<div class="number-field dashed thin" title="всего вернуть / всего получить.
{{((account.meta.posBalance + account.meta.negBalance) != 0) ? 'Неделимый остаток ' + exact(account.meta.posBalance + account.meta.negBalance) : ''}}">
										<b>
											{{getReturnsBalance()}} <s>{{getAccountCurrency()}}</s>
										</b>
									</div>
								</li>
							</ul>
						</div>


						<!-- Через общий банк -->
						<div ng-if="!account.settings.fixationDirectly">
							<ul class="flex flex-wrap">
								<li class="flex-shrink">
									<div class="text-field title thin">
										<b>Баланс возвратов:</b>
									</div>
								</li>
							</span>
								<li class="flex-grow s-p1">
									<div class="number-field dashed thin" title="всего вернуть / всего получить">
										<b>
											{{getReturnsBalance('byBank')}}
											<s>{{getAccountCurrency()}}</s>
										</b>
									</div>
								</li>
							</ul>

							<ul class="flex flex-wrap">
								<li class="flex-shrink">
									<div class="text-field title thin">
										<b>Общий банк:</b>
									</div>
								</li>

								<li class="flex-grow s-p1">
									<div class="number-field dashed thin" title="сумма в общем банке">
										<b>
											{{getAccountBank()}}
											<s>{{getAccountCurrency()}}</s>
										</b>
									</div>
								</li>
							</ul>
						</div>

                        <ul class="flex mt-2 mb-2" ng-if="account.settings.fixationDirectly && account.meta.negBalance != 0 && account.meta.posBalance != 0">
                            <li class="flex-shrink s-p0">
                                <button class="btn solid note" title="Автоматическое распределение возвратов"
                                        ng-click="autoPaymentsFixation()">
                                    <i class="fas fa-magic"></i>
                                </button>
                            </li>

                            <li class="flex-grow flex-hidden s-p0">
                                <div class="text-field name">
                                    <b>Автоматическое распределение возвратов</b>
                                </div>
                            </li>
                        </ul>
					</div>

					<div class="section-body">

						<!-- Возвраты напрямую -->
						<ul class="participants" ng-if="account.settings.fixationDirectly">
							<li id="participant.3.{{participantIndex}}" class="participant"
								ng-repeat="participant in account.participants track by $index"
								ng-class="{'debtor': participant.meta.fullBalance < 0, 'sponsor': participant.meta.fullBalance > 0, 'open-body': expCalc.settings.isHelpMode}"
								ng-init="participantIndex = $index">

								<div class="participant-head">
									<ul class="flex s-p0 with-separator">
										<li class="flex flex-grow flex-wrap s-p0">
											<div class="text-field solid title">
												<b>{{participantIndex + 1}}.</b>
											</div>

											<div class="flex-grow text-field title solid s-p1 title-max-width">
                                                <b>{{getParticipantName(participant.meta.title, participantIndex)}}</b>
											</div>

											<div class="text-select complex-input"
												 ng-if="participant.meta.fullBalance > 0 && expCalc.accounts[expCalc.settings.currentAccount].settings.advancedMode">
												<div class="text-field">
													<b>получит</b>
												</div>

												<label class="currency">
													<select ng-model="participant.meta.preferredCurrency"
															ng-options="key as value for (key, value) in expCalc.settings.currencies.names"
															ng-change="uploadData()">
													</select>
													<b>{{expCalc.settings.currencies.names[participant.meta.preferredCurrency].substring(0, 3)}}</b>
												</label>
											</div>
											<div class="text-field title solid s-p1"
												 ng-if="participant.meta.fullBalance > 0 && !expCalc.accounts[expCalc.settings.currentAccount].settings.advancedMode">
												<b>получит</b>
											</div>
											<div class="text-field title solid s-p1"
												 ng-if="participant.meta.fullBalance < 0">
												<b>вернет</b>
											</div>

											<div class="flex flex-grow">
												<div class="flex-grow number-field solid text-left uppercase s-p1"
													 ng-if="participant.meta.fullBalance >= 0 && participant.meta.preferredCurrency != account.settings.accountCurrency">
													<b>
                                                        {{getParticipantFullBalance(participant, participantIndex, true)}}
														<s>{{expCalc.settings.currencies.names[participant.meta.preferredCurrency].substring(0, 3)}}</s>
													</b>
												</div>
                                                <div class="flex-grow number-field solid text-center"
                                                     ng-if="participant.meta.fullBalance >= 0 && participant.meta.preferredCurrency != account.settings.accountCurrency">
                                                    <b>>>></b>
                                                </div>
												<div class="flex-grow number-field solid s-p1"
                                                     title="{{(participant.meta.fullBalance && (!account.meta.posBalance || !account.meta.negBalance)) ? 'Неделимый остаток' : ''}}">
													<b>
														<span ng-class="{'line-through-text': participant.meta.fullBalance && (!account.meta.posBalance || !account.meta.negBalance)}">
                                                            {{getParticipantFullBalance(participant, participantIndex, false)}}
                                                        </span>
														<s>{{getAccountCurrency()}}</s>
													</b>
												</div>
											</div>
										</li>

										<li class="flex-shrink s-p0">
											<button class="btn solid border collapse-btn" title="Показать/Спрятать"
													ng-mobile-click="layoutControl.toggleBodyView(3, 'participant.3.' + participantIndex)">
												<i class="fas fa-chevron-down"></i>
											</button>
										</li>
									</ul>
								</div>

								<div class="participant-body">

									<div class="body-view pt-2">
                                        <div class="help-text no-arrow mb-1"
                                             ng-if="expCalc.settings.isHelpMode && participant.meta.fullBalance < 0"
                                             ng-class="{'hidden': participant.meta.fullBalance && (!account.meta.posBalance || !account.meta.negBalance)}">
                                            <b><i class="fas fa-info-circle"></i>
                                                <span ng-if="!participant.meta.areNotAllRefundsFixed">
                                                    [{{getParticipantName(participant.meta.title, participantIndex)}}] должен(а) вернуть {{-getParticipantFullBalance(participant, participantIndex, false)}} {{getAccountCurrency()}}.
                                                    Рассчитаться можно следующим способом:
                                                    <ul class="debt-help">
                                                        <li class="debt-item-help"
                                                              ng-repeat="sponsor in account.participants track by $index"
                                                              ng-if="participant.meta.fullBalance < 0 && getRest(sponsor, participant).rest > 0">
                                                            -
                                                            <span ng-if="-getParticipantFullBalance(participant, participantIndex, false) <= getRest(sponsor, participant).rest">сразу всё </span>
                                                            <span>вернуть участнику [{{(sponsor.meta.title) ? sponsor.meta.title : 'Участник ' + ($index + 1)}}] -
                                                                <span class="text-nowrap">{{getRest(sponsor, participant).rest}} {{expCalc.settings.currencies.names[getRest(sponsor, participant).currency].toUpperCase()}}</span></span>
                                                            <span ng-if="account.participants.length > 2 && -getParticipantFullBalance(participant, participantIndex, false) > getRest(sponsor, participant).rest">
                                                                , а остальное отдать другому участнику (приложение покажет кому именно после фиксации этого взноса)
                                                            </span>
                                                        </li>
                                                    </ul>
                                                </span>
                                                <span ng-if="participant.meta.areNotAllRefundsFixed">
                                                    Не забудьте зафиксировать взнос, когда [{{getParticipantName(participant.meta.title, participantIndex)}}] вернет указанную сумму
                                                </span>
                                            </b>
                                        </div>

										<div class="block text-field name thin s-p4" ng-if="participant.fixation.whom.length">
											<b>[{{getParticipantName(participant.meta.title, participantIndex)}}] делает взносы участникам:</b>
										</div>

										<ul class="payments" ng-init="checkAllFixedRefunds(participant)">
											<li ng-repeat="refund in participant.fixation.whom track by $index"
												ng-init="refundIndex = $index; refundNumber = refund.number" ng-class="{'accent': expCalc.settings.isHelpMode}">

												<ul class="flex s-p0">
													<li class="flex-shrink s-p0" ng-if="!refund.isFixed">
														<button class="btn solid warning" title="Удалить этот взнос"
																ng-click="removePayment(participant, refundIndex)">
															<i class="fas fa-trash-alt"></i>
														</button>
													</li>

													<li class="flex-shrink s-p0" ng-if="refund.isFixed">
														<div class="date-field text-nowrap">
															<b>{{formatDate(refund.date, 1)}}</b>
															<b>{{formatDate(refund.date, 2)}}</b>
															<b>{{formatDate(refund.date, 3)}}</b>
														</div>
													</li>

													<li class="flex-grow flex-hidden s-p0 selected-participant">
														<label class="text-select" ng-disabled="refund.isFixed">
                                                            {{refund}}
															<select	ng-model="refund.number"
																	ng-change="fillRefundFields(participant, refund)">
																<option value="" hidden disabled selected>Выберите участника</option>

																<option ng-repeat="sponsor in account.participants track by $index"
																		value="{{$index}}" ng-if="participantIndex != $index">
																	{{getParticipantOption(sponsor, participant, $index + 1)}}
																</option>
															</select>
															<b>{{(refund.number) ? getParticipantName(account.participants[refund.number].meta.title, refund.number * 1) : 'Выберите участника' }}</b>
														</label>
													</li>

													<li class="s-p0">
														<div class="multiple-field">
															<label class="text-select currency"
																   ng-disabled="refund.isFixed || !expCalc.accounts[expCalc.settings.currentAccount].settings.advancedMode">
																<select ng-model="refund.currency">
																	<option value="" hidden disabled selected>---</option>
																	<option ng-repeat="currency in expCalc.settings.currencies.names track by $index"
																			value="{{$index}}">
																		{{currency}}
																	</option>
																</select>
																<b>{{(refund.currency != null) ? expCalc.settings.currencies.names[refund.currency].substring(0, 3) : '???'}}</b>
															</label>

															<label class="number-input" ng-disabled="refund.isFixed">
																<input type="number" ng-model="refund.value">
																<b>{{refund.value}}</b>
															</label>
														</div>
													</li>

													<li class="flex-shrink s-p0">
														<label class="checkbox">
															<input type="checkbox" ng-model="refund.isFixed"
																   ng-change="checkRefundFields(refund, participant)" />
															<i></i>
														</label>
													</li>
												</ul>

											</li>

											<li ng-if="isAllRefundsFixed(participant)">
												<ul class="flex s-p0">
													<li class="flex-shrink s-p0">
														<button class="btn solid success" title="Сделать новый взнос"
																ng-click="addNewPayment(participant)">
															<i class="fas fa-plus"></i>
														</button>
													</li>

													<li class="flex-grow flex-hidden s-p0">
														<div class="text-field name">
															<b>Сделать новый взнос</b>
														</div>
													</li>
												</ul>
											</li>
										</ul>

                                        <div class="help-text" ng-if="expCalc.settings.isHelpMode && !participant.fixation.whom.length">
                                            <b><i class="fas fa-info-circle"></i> Добавляйте взносы, чтобы зафиксировать возврат долгов или просто чтобы учесть эти взносы в будущих расчётах</b>
                                        </div>
									</div>

								</div>
							</li>
						</ul>



						<!-- Через общий банк -->
						<ul class="participants" ng-if="!account.settings.fixationDirectly">
							<li id="participantByBank.3.{{participantIndex}}" class="participant"
								ng-repeat="participant in account.participants track by $index"
								ng-class="{'debtor': participant.meta.fullBalanceByBank < 0, 'sponsor': participant.meta.fullBalanceByBank > 0, 'open-body': expCalc.settings.isHelpMode}"
								ng-init="participantIndex = $index">

								<div class="participant-head">
									<ul class="flex s-p0 with-separator">
										<li class="flex flex-grow flex-wrap s-p0">
											<div class="text-field solid title">
												<b>{{participantIndex + 1}}.</b>
											</div>

											<div class="flex-grow text-field name solid s-p1 title-max-width">
                                                <b>{{getParticipantName(participant.meta.title, participantIndex)}}</b>
											</div>

											<div class="flex-grow number-field solid marker">
												<b>
													{{getParticipantFullBalanceByBank(participant)}}
													<s>
														<span ng-if="participant.meta.fullBalanceByBank != 0">
															{{participant.meta.fullBalanceByBank >= 0 ? 'Получит' : 'Вернет:'}}
														</span> ({{getAccountCurrency()}}):
													</s>
												</b>
											</div>
										</li>

										<li class="flex-shrink s-p0">
											<button class="btn solid border collapse-btn" title="Показать/Спрятать"
													ng-mobile-click="layoutControl.toggleBodyView(3, 'participantByBank.3.' + participantIndex)">
												<i class="fas fa-chevron-down"></i>
											</button>
										</li>
									</ul>
								</div>

								<div class="participant-body">

									<div class="body-view">
										<ul class="payments to-bank">
											<li class="s-p1">
												<div class="help-text no-arrow"
													 ng-if="expCalc.settings.isHelpMode">
													<b><i class="fas fa-info-circle"></i> Чтобы рассчитаться через общий банк, должники должны отдать свои долги в общий банк,
														а спонсоры потом смогут получить свои суммы из банка. А все эти манипуляции здесь фиксируются.</b>
												</div>
											</li>

											<li ng-repeat="byBankObject in participant.fixation.byBank track by $index"
												ng-init="byBankObjectIndex = $index">

												<ul class="flex s-p0">
													<li class="flex-shrink s-p0" ng-if="!byBankObject.isFixed">
														<button class="btn solid warning" title="Удалить это действие"
																ng-click="removePaymentByBank(participant, byBankObjectIndex)">
															<i class="fas fa-trash-alt"></i>
														</button>
													</li>

													<li class="flex-shrink s-p0" ng-if="byBankObject.isFixed">
														<div class="date-field">
															<b>{{formatDate(byBankObject.date, 1)}}</b>
															<b>{{formatDate(byBankObject.date, 2)}}</b>
															<b>{{formatDate(byBankObject.date, 3)}}</b>
														</div>
													</li>

													<li class="flex-grow s-p0">
														<div class="text-field name">
															<b ng-if="byBankObject.token < 0">Отдал</b>
															<b ng-if="byBankObject.token > 0">Получил</b>
														</div>
													</li>

													<li class="flex-grow s-p0">
														<div class="multiple-field">
															<label class="text-select currency" disabled>
																<select></select>
																<b>{{getAccountCurrency()}}</b>
															</label>

															<label class="number-input" ng-disabled="byBankObject.isFixed">
																<input type="number" ng-model="byBankObject.value">
																<b>{{byBankObject.value}}</b>
															</label>
														</div>
													</li>

													<li class="flex-shrink s-p0">
														<label class="checkbox">
															<input type="checkbox" ng-model="byBankObject.isFixed"
																   ng-change="checkPaymentByBank(byBankObject)">
															<i></i>
														</label>
													</li>
												</ul>

											</li>

											<li>

												<ul class="flex s-p0">
													<li class="flex-shrink s-p0">
														<button class="btn solid success" title="Получить деньги из банка"
																ng-click="addNewPaymentByBank(participant, 1)">
															<i class="fas fa-hand-holding-usd"></i>
															<b class="small">Получить</b>
														</button>
													</li>

													<li class="flex-shrink s-p0">
														<button class="btn solid success" title="Отдать деньги в банк"
																ng-click="addNewPaymentByBank(participant, -1)">
															<i class="fas fa-dollar-sign"></i>
															<b class="small">Отдать</b>
														</button>
													</li>
												</ul>

											</li>
										</ul>
									</div>

								</div>
							</li>
						</ul>
					</div>

				</div>

				<div class="control-lt">
					<button class="btn solid border"
							title="Прокрутка вверх к началу"
							ng-click="layoutControl.scrollUp(3)">
						<i class="fas fa-arrow-circle-up"></i>
					</button>
				</div>
			</li>
		</ul>
	</div>



	<div class="print-view-lt"
		 ng-if="expCalc.settings.currentAccount == $index"
		 ng-repeat="account in expCalc.accounts track by $index">

		<table class="currencies" ng-init="currencies = expCalc.settings.currencies">
			<thead>
			<tr>
				<th class="hidden"> </th>
				<th colspan="100">Курс, по которому покупается указанная валюта</th>
			</tr>
			<tr>
				<th class="hidden">Основная валюта</th>
				<th ng-repeat="name in currencies.names track by $index">
					1 {{currencies.names[$index]}} =
				</th>
			</tr>
			</thead>

			<tbody>
			<tr ng-repeat="name in expCalc.settings.currencies.names track by $index" ng-init="nameIndex = $index">
				<td class="hidden">
					{{expCalc.settings.currencies.names[$index]}}
				</td>
				<td ng-repeat="array in currencies.rates[nameIndex] track by $index">
					{{currencies.rates[nameIndex][$index]}} <b class="small-bold">{{expCalc.settings.currencies.names[nameIndex]}}</b>
				</td>
			</tr>
			</tbody>
		</table>

		<table class="expenses-table">
			<thead>
			<tr>
				<th colspan="4" class="border-right"></th>

				<th ng-repeat="participant in account.participants track by $index">
					{{participant.meta.title}}<br/>(Участие {{participant.meta.participation * 100}}%)
				</th>
			</tr>
			</thead>

			<tbody>
			<tr>
				<td class="font-weight-bold">Расходы</td>
				<td class="font-weight-bold">Тип</td>
				<td class="font-weight-bold">Дата</td>
				<td class="font-weight-bold border-right">Сумма</td>
				<td colspan="100" class="font-weight-bold">Доля участника в каждом расходе</td>
			</tr>
			</tbody>

			<tbody ng-repeat="participant in account.participants track by $index"
				   ng-init="extParticipantIndex = $index">
			<tr>
				<td colspan="3" class="font-weight-bold">{{participant.meta.title}}</td>
				<td class="border-right">Все расходы:
					<span class="nowrap font-weight-bold">{{roundOff(participant.meta.total)}}&nbsp;{{getAccountCurrency()}}</span>
				</td>

				<td ng-repeat="extParticipant in account.participants track by $index"> </td>
			</tr>

			<tr ng-repeat="expense in participant.expenses track by $index" ng-if="expense.isPaid">
				<td>
					<span class="float-left">{{$index + 1}}.</span>
					{{expense.title}}
				</td>
				<td><span class="small">{{expCalc.settings.expensesTypes[expense.type].name}}</span></td>
				<td><span class="small">{{formatDate(expense.date)}}</span></td>
				<td class="border-right"><span class="nowrap">{{expense.value}}&nbsp;{{expCalc.settings.currencies.names[expense.currency].toUpperCase()}}</span></td>

				<td ng-repeat="extParticipant in account.participants track by $index"
					ng-init="extParticipantIndex = $index">
				<span class="nowrap">
					{{roundOff(getExpenseShare(expense, extParticipantIndex))}}
					<span ng-if="roundOff(getExpenseShare(expense, extParticipantIndex)) != 0">{{getAccountCurrency()}}</span>
				</span>
				</td>
			</tr>

			</tbody>

			<tbody>
			<tr>
				<td colspan="3"></td>
				<td class="font-weight-bold border-right">Всех расходов: <span class="nowrap">{{roundOff(getAccountTotal())}}&nbsp;{{getAccountCurrency()}}</span></td>

				<td ng-repeat="participant in account.participants track by $index"
					ng-init="participantIndex = $index">
					Всего:
					<span class="nowrap font-weight-bold">{{roundOff(getParticipantShare(participantIndex))}}&nbsp;{{getAccountCurrency()}}</span>
				</td>
			</tr>
			</tbody>

			<thead><tr><th colspan="100"><hr/></th><tr></thead>

			<tbody>
			<tr>
				<td colspan="4" class="font-weight-bold text-right border-right">Расходы по типам:</td>
				<td colspan="100"></td>
			</tr>
			<tr ng-repeat="expensesType in expCalc.settings.expensesTypes track by $index"
				ng-init="typeIndex = $index">
				<td colspan="4" class="text-right border-right">{{expensesType.name}}</td>

				<td ng-repeat="participant in account.participants track by $index">
					<span class="nowrap">{{participant.meta.expensesByTypes[typeIndex]}}&nbsp;{{getAccountCurrency()}}</span>
				</td>
			</tr>
			</tbody>

			<thead><tr><th colspan="100"><hr/></th><tr></thead>

			<tbody>
			<tr>
				<td colspan="4" class="font-weight-bold text-right border-right"></td>
                <td ng-repeat="participant in account.participants track by $index">
                    {{participant.meta.title}}<br/>(Участие {{participant.meta.participation * 100}}%)
                </td>
			</tr>
            <tr>
                <td colspan="4" class="font-weight-bold text-right border-right">
                    Взносы
                    <span ng-if="account.settings.fixationDirectly">от участника -> участнику</span>
                    <span ng-if="!account.settings.fixationDirectly">через общий банк</span>
                    :
                </td>
                <td colspan="100">
				<span class="font-weight-bold" ng-if="!account.settings.fixationDirectly">
					В общем банке: {{account.meta.bank}}&nbsp;{{getAccountCurrency()}}
				</span>
                </td>
            </tr>
			</tbody>

			<tbody ng-repeat="participant in account.participants track by $index"
				   ng-if="account.settings.fixationDirectly">
			<tr ng-repeat="whom in participant.fixation.whom track by $index">
				<td colspan="2"></td>
				<td><span class="small">{{formatDate(whom.date)}}</span></td>
				<td class="border-right">{{participant.meta.title}} -></td>

				<td ng-repeat="participant in account.participants track by $index">
				<span class="nowrap" ng-if="whom.number == $index">
					{{(!whom.isFixed) ? 'вернет' : ''}}
					{{whom.value}}&nbsp;{{expCalc.settings.currencies.names[whom.currency].toUpperCase()}}
				</span>
				</td>
			</tr>
			</tbody>

			<tbody ng-repeat="participant in account.participants track by $index"
				   ng-init="participantIndex = $index"
				   ng-if="!account.settings.fixationDirectly">
			<tr ng-repeat="byBank in participant.fixation.byBank track by $index">
				<td colspan="2"></td>
				<td><span class="small">{{formatDate(byBank.date)}}</span></td>
				<td class="border-right">
					<span ng-if="byBank.token > 0">Получил</span>
					<span ng-if="byBank.token < 0">Вернул</span>
				</td>

				<td ng-repeat="participant in account.participants track by $index">
				<span class="nowrap" ng-if="participantIndex == $index">
					<span ng-if="byBank.token > 0">+</span>
					<span ng-if="byBank.token < 0">-</span>
					{{byBank.value}}&nbsp;{{getAccountCurrency()}}
				</span>
				</td>
			</tr>
			</tbody>

			<tbody>
			<tr>
				<td colspan="4" class="border-right"></td>
				<td colspan="100" class="font-weight-bold"><hr/>Окончательный расчет<hr/></td>
			</tr>
			<tr ng-if="account.settings.fixationDirectly">
				<td colspan="4" class="border-right"></td>

				<td class="font-weight-bold" ng-repeat="participant in account.participants track by $index">
					<div ng-if="participant.meta.fullBalance > 0">Получить</div>
					<div ng-if="participant.meta.fullBalance < 0">Вернуть</div>
					<span class="nowrap" style="font-size: 1.5rem">
					<span ng-if="participant.meta.fullBalance > 0">+</span>{{participant.meta.fullBalance}}&nbsp;{{getAccountCurrency()}}
				</span>
				</td>
			</tr>
			<tr ng-if="!account.settings.fixationDirectly">
				<td colspan="4" class="border-right"></td>

				<td class="font-weight-bold" ng-repeat="participant in account.participants track by $index">
					<div ng-if="participant.meta.fullBalanceByBank > 0">Получить</div>
					<div ng-if="participant.meta.fullBalanceByBank < 0">Вернуть</div>
					<span class="nowrap" style="font-size: 1.5rem">
					<span ng-if="participant.meta.fullBalanceByBank > 0">+</span>{{participant.meta.fullBalanceByBank}}&nbsp;{{getAccountCurrency()}}
				</span>
				</td>
			</tr>
			</tbody>
		</table>


	</div>

</main>